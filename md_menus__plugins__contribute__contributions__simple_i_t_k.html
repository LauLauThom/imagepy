<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ImagePy: itk-plgs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ImagePy
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_menus__plugins__contribute__contributions__simple_i_t_k.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">itk-plgs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Path:</b> <a href="https://github.com/Image-Py/itk-plgs">https://github.com/Image-Py/itk-plgs</a></p>
<p><b>Version:</b> 0.1</p>
<p><b>Author:</b> YXDragon</p>
<p><b>Email:</b> <a href="#" onclick="location.href='mai'+'lto:'+'yxd'+'ra'+'gon'+'@i'+'mag'+'ep'+'y.o'+'rg'; return false;">yxdra<span style="display: none;">.nosp@m.</span>gon@<span style="display: none;">.nosp@m.</span>image<span style="display: none;">.nosp@m.</span>py.o<span style="display: none;">.nosp@m.</span>rg</a></p>
<p><b>Keyword:</b> itk, segment</p>
<p><b>Description:</b> SimpleITK plugin set for ImagePy</p>
<p>you must fill the information upon, and you can not remove or insert line, you can write free below.</p>
<h2>Document</h2>
<p><b>Introduction:</b> itk need not much introductions, It is a 2D/3D image segment library. ImagePy is a interactive image processing framework which can wrap any numpy based library esaily. And supporting multi-channels, imagestack, lookuptable, roi, macros recorder...It is a Plugin system(just like ImageJ but more convenient). This project is a wrapper of itk for ImagePy plugins!</p>
<p><b>Now It is just a start, I wrap little of itk's algrism, aimed to introduct how to wrote ImagePy plugin, The Demo in this document is representative.</b></p>
<h2>License </h2>
<p>I know many numpy based project has a BSD license, but, sorry, I use SimpleITK, so must be under LGPL.</p>
<h2>MainFrame </h2>
<img src="http://idoc.imagepy.org/itk/mainframe.png" alt="mainframe" class="inline"/>
<p>It is ImagePy's MainFrame, like ImageJ. And ImagePy has contains many common function, such as open image, save image, do some filter, do a roi, draw with pencil... It requires wxpython as ui, Numpy as base structure, shapely to treat the roi, and scipy.ndimage to so dome common filter. But this project devotes to <b>do a wrapper for itk</b></p>
<h2>Add reader and writer </h2>
<p>Itk supports many medical format, such as dicom, nii... Now let's add reader and writer plugins for ImagePy. </p><h3>first we add read, write function</h3>
<p>as itk read any format as a image sequence, but sometimes we need read one slice. so we write a <b>readall</b>, then write a <b>read</b>. </p><div class="fragment"><div class="line">import SimpleITK as sitk</div><div class="line">import numpy as np</div><div class="line"></div><div class="line">def readall(path):</div><div class="line">    image = sitk.ReadImage(path)</div><div class="line">    arr = sitk.GetArrayFromImage(image)</div><div class="line">    if arr.dtype == np.int16:</div><div class="line">        arr = arr.astype(np.int32)</div><div class="line">    return arr</div><div class="line"></div><div class="line">def read(path):return readall(path)[0]</div><div class="line"></div><div class="line">def write(path, img):</div><div class="line">    sitk.WriteImage(sitk.GetImageFromArray(img), path)</div></div><!-- fragment --><p> ### register reader and writer to the io manager </p><div class="fragment"><div class="line">from imagepy.core.util import fileio</div><div class="line"></div><div class="line"># add dicom reader and writer</div><div class="line">fileio.add_reader([&#39;dcm&#39;], read)</div><div class="line">fileio.add_writer([&#39;dcm&#39;], write)</div><div class="line"></div><div class="line">class OpenDCM(fileio.Reader):</div><div class="line">    title = &#39;DICOM Open&#39;</div><div class="line">    filt = [&#39;DCM&#39;]</div><div class="line"></div><div class="line">class SaveDCM(fileio.Writer):</div><div class="line">    title = &#39;DICOM Save&#39;</div><div class="line">    filt = [&#39;DCM&#39;]</div><div class="line">    </div><div class="line"># add nii reader and writer, because nii is a sequence, so ruse read all, and give as a tuple.</div><div class="line">fileio.add_reader([&#39;nii&#39;], (readall,))</div><div class="line">fileio.add_writer([&#39;nii&#39;], (write,))</div><div class="line"></div><div class="line">class OpenNII(fileio.Reader):</div><div class="line">    title = &#39;NII Open&#39;</div><div class="line">    filt = [&#39;NII&#39;]</div><div class="line"></div><div class="line">class SaveNII(fileio.Reader):</div><div class="line">    title = &#39;NII Save&#39;</div><div class="line">    filt = [&#39;NII&#39;]</div><div class="line"></div><div class="line">plgs = [OpenDCM, SaveDCM, &#39;-&#39;, OpenNII, SaveNII]</div></div><!-- fragment --><h2>Do a simple filter </h2>
<img src="http://idoc.imagepy.org/itk/gradient.png" alt="gradient" class="inline"/>
 <div class="fragment"><div class="line">import SimpleITK as sitk</div><div class="line">from imagepy.core.engine import Filter</div><div class="line"></div><div class="line">class Plugin(Filter):</div><div class="line">    title = &#39;ITK Gradient Magnitude&#39;</div><div class="line">    note = [&#39;all&#39;, &#39;auto_msk&#39;, &#39;auto_snap&#39;]</div><div class="line"></div><div class="line">    def run(self, ips, snap, img, para = None):</div><div class="line">        img = sitk.GetImageFromArray(img)</div><div class="line">        img = sitk.GradientMagnitude(img)</div><div class="line">        return sitk.GetArrayFromImage(img)</div></div><!-- fragment --> <h3>These gradient operator is simplest filter with no parameter.</h3>
<ol type="1">
<li>class name must be Plugin</li>
<li>title is necessary, be the plugin's id, show in menus.</li>
<li>set the note, which tells ImagePy what to do for you.</li>
<li>overwrite run method return the result</li>
</ol>
<p>Filter is one of engines, means need a image, then do some change on it, It has a run method in such type:</p><ul>
<li><b>ips</b> is the wrapper of image with some other information (lookup table, roi...)</li>
<li><b>snap</b> is a snapshot of the image, if 'auto_snap' in note, ImagePy will copy the image to snap befor run. (for many filter method must be implemented in a buffer)</li>
<li><b>img</b> is the current image you are processing.</li>
<li><b>para</b> is the parameter you got interactive. (there is no here) <h3>note is very important</h3>
</li>
</ul>
<ul>
<li><b>all</b> means this plugin works for all type image.</li>
<li><b>auto_snap</b> means ImagePy do a snapshot befor processing, then you can use Undo.</li>
<li><b>auto_msk</b> means when there is a roi on the image, Plugin will only influnce the pixel in.</li>
<li>more detail information please see <a href="https://github.com/Image-Py/imagepy">ImagePy's README</a>!</li>
</ul>
<h2>Filter with parameter </h2>
<img src="http://idoc.imagepy.org/itk/gaussian.png" alt="gaussian" class="inline"/>
 <div class="fragment"><div class="line"># -*- coding: utf-8 -*</div><div class="line">import SimpleITK as sitk</div><div class="line">from imagepy.core.engine import Filter</div><div class="line"></div><div class="line">class Plugin(Filter):</div><div class="line">    title = &#39;ITK Discrete Gaussian&#39;</div><div class="line">    note = [&#39;all&#39;, &#39;auto_msk&#39;, &#39;auto_snap&#39;, &#39;preview&#39;]</div><div class="line">    para = {&#39;sigma&#39;:1.0}</div><div class="line">    view = [(float, (0,10), 1,  &#39;sigma&#39;, &#39;sigma&#39;, &#39;pix&#39;)]</div><div class="line"></div><div class="line">    def run(self, ips, snap, img, para = None):</div><div class="line">        itkimg = sitk.GetImageFromArray(snap)</div><div class="line">        itkimg = sitk.DiscreteGaussian(itkimg, para[&#39;sigma&#39;])</div><div class="line">        return sitk.GetArrayFromImage(itkimg)</div></div><!-- fragment --><p> Many Filter need some parameter. Just like Gaussian. We just need do a little more.</p><ol type="1">
<li><b>para</b> is a dict object, which contains the parameter you need.</li>
<li><b>view</b> tell ImagePy how to interact when this plugin run, **(float, (0,10), 1, 'sigma', 'sigma', 'pix')** means it is a float between 0 and 10, title is sigma, corresponding to the sigma parameter with unit pix. More detail information please see <a href="https://github.com/Image-Py/imagepy">ImagePy's README</a>!</li>
</ol>
<p><b>Add 'preview' in note, then when you adjust the parameter, ImagePy run this plugin immediately</b></p>
<h2>Write 3D Filter </h2>
<img src="http://idoc.imagepy.org/itk/gaussian3d.png" alt="gaussian3d" class="inline"/>
 <div class="fragment"><div class="line">import SimpleITK as sitk</div><div class="line">from imagepy.core.engine import  Simple</div><div class="line"></div><div class="line">class Plugin(Simple):</div><div class="line">    title = &#39;ITK Gradient Magnitude 3D&#39;</div><div class="line">    note = [&#39;all&#39;, &#39;stack3d&#39;]</div><div class="line"></div><div class="line">    def run(self, ips, imgs, para = None):</div><div class="line">        itkimgs = sitk.GetImageFromArray(imgs)</div><div class="line">        itkimgs = sitk.GradientMagnitude(itkimgs)</div><div class="line">        imgs[:] = sitk.GetArrayFromImage(itkimgs)</div></div><!-- fragment --><p> when there is a image sequence, If you run a gaussian filter, it will ask if you want to process every slice. If ok, it will process slice by slice. But a 3d gaussian filter will blur the image sequence by <b>X, Y and Z axis</b>.</p>
<p><b>Filter</b> aimed at treat a single slice, but if you want to process the whole images, please extends a <b>Simple</b>. It also can process other information. eg. set the look up table, or treat the roi, or save the current image/image sequence.</p>
<h2>Treat ROI and ColorImage </h2>
<img src="http://idoc.imagepy.org/itk/roicolor.png" alt="roicolor" class="inline"/>
 <div class="fragment"><div class="line">import SimpleITK as sitk</div><div class="line">from imagepy.core.engine import Filter, Simple</div><div class="line">import numpy as np</div><div class="line"></div><div class="line">class Plugin(Filter):</div><div class="line">    title = &#39;ITK Canny EdgeDetection&#39;</div><div class="line">    note = [&#39;all&#39;, &#39;auto_msk&#39;, &#39;auto_snap&#39;, &#39;2float&#39;, &#39;preview&#39;]</div><div class="line">    para = {&#39;sigma&#39;:1.0, &#39;low_threshold&#39;:10, &#39;high_threshold&#39;:20}</div><div class="line">    view = [(float, (0,10), 1,  &#39;sigma&#39;, &#39;sigma&#39;, &#39;pix&#39;),</div><div class="line">            (&#39;slide&#39;,(0,50), &#39;low_threshold&#39;, &#39;low_threshold&#39;,&#39;&#39;),</div><div class="line">            (&#39;slide&#39;,(0,50), &#39;high_threshold&#39;, &#39;high_threshold&#39;,&#39;&#39;)]</div><div class="line"></div><div class="line">    def run(self, ips, snap, img, para = None):</div><div class="line">        img = sitk.GetImageFromArray(snap)</div><div class="line">        img = sitk.CannyEdgeDetection(img, para[&#39;low_threshold&#39;], para[&#39;high_threshold&#39;], [para[&#39;sigma&#39;]]*2)</div><div class="line">        return sitk.GetArrayFromImage(img)*ips.range[1]</div></div><!-- fragment --><p> You see, we did not write code to treat the color image, but it works, and We can draw a ROI on the image, only the ROI area be changed! And we can undo the lasted operation. <b>Even if it is a imagestack, ImagePy will ask you if run every slice!!</b></p>
<h2>Watershed With ROI </h2>
<img src="http://idoc.imagepy.org/itk/roiwatershed.png" alt="roiwatershed" class="inline"/>
 <div class="fragment"><div class="line">import SimpleITK as sitk</div><div class="line">from imagepy.core.engine import Filter, Simple</div><div class="line">import numpy as np</div><div class="line"></div><div class="line">class Plugin(Filter):</div><div class="line">    title = &#39;ITK Watershed Manual Marker&#39;</div><div class="line">    note = [&#39;8-bit&#39;, &#39;not_slice&#39;, &#39;auto_snap&#39;, &#39;req_roi&#39;]</div><div class="line">    </div><div class="line">    para = {&#39;sigma&#39;:2}</div><div class="line">    view = [(int, (0,10), 0,  &#39;sigma&#39;, &#39;sigma&#39;, &#39;pix&#39;)]</div><div class="line">    </div><div class="line">    def run(self, ips, snap, img, para = None):</div><div class="line">        itkimg = sitk.GetImageFromArray(img)</div><div class="line">        itkimg = sitk.DiscreteGaussian(itkimg, para[&#39;sigma&#39;])</div><div class="line">        itkimg = sitk.GradientMagnitude(itkimg)</div><div class="line">        itkmarker = sitk.GetImageFromArray(ips.get_msk().astype(np.uint16))</div><div class="line">        itkmarker = sitk.ConnectedComponent(itkmarker, fullyConnected=True)</div><div class="line">        lineimg = sitk.MorphologicalWatershedFromMarkers(itkimg, itkmarker, markWatershedLine=True)</div><div class="line">        labels = sitk.GetArrayFromImage(lineimg)</div><div class="line">        return np.where(labels==0, ips.range[1], 0)</div></div><!-- fragment --><p>ImagePy support ROI, you can use tool to draw a roi(point, line, polygon...), And We can use ips.roi access it, and ips.get_msk(mode='in') to get the roi mask image. <b>mode can be 'in','out',or int means a sketch with specific width.</b> Then use the mask as marker to do a watershed,</p>
<ol type="1">
<li><b>req_roi</b> means this plugin need a roi, ImagePy will check for you, if ther is not, interrupt the plugin.</li>
<li><b>not_slice</b> tells Imagepy need not to iterate slices if it is a stack, because this interactive is just ok for specific image, there is no need to go through.</li>
</ol>
<h2>Watershed3D And Surface Reconstruct </h2>
<img src="http://idoc.imagepy.org/itk/3dsurface.png" alt="surface" class="inline"/>
<p>we can also do a 3d watershed, <b>mark the up and down as two markers</b>, then <b>watershed on the 3d gradient image</b>. we can get a perfect mask. Then do a 3d surface reconstruction with <b>vtk(mayavi)</b>.</p>
<h2>Macros </h2>
<img src="http://idoc.imagepy.org/itk/macros.png" alt="macros" class="inline"/>
<p><b>Macros</b> is one of engines, It is a text file with every line as: **"PluginID &gt; {parameter}"**, If the parameter is None and the Plugin need parameter, IPy will show dialog to interact, if the parameter is given, ImagePy just run use the given parameter.</p>
<p>We can Open the <b>Plugin &gt; Macros &gt; Macros Recorder</b> to record the operate. Then save as a file with **.mc** extent under the menus folder. It will be parsed as a menu when started next. This is Macros, We never need to implements ourself.</p>
<p>Then we Try the <b>Find And Mark Coins</b> macros, Wow!, It run the command sequence automatically!</p>
<p><b>We can use Macros to do some bat processing, what more? It can be used as a good tutorial, We just implement the basic method, and use macros to show this method can solve such problem!!!</b></p>
<h2>MarkDown </h2>
<p>you can also write a markdown file, and lay it under any sub folder of menus, when ImagePy setup, It will be loaded as a menus too, when click it, the markdown page will show.</p>
<h2>About the plugin's order </h2>
<img src="http://idoc.imagepy.org/itk/order.png" alt="order" class="inline"/>
<p>ImagePy is a plugin framework. The Catlog will be parsed as the corresponding menus. You just copy package under the menus folder or it's sub folder. But the question is, Our function will be in a disordered order. <b>So we can add a list called catlog under every init file.</b></p>
<p>Now ITK menu is before the Help, and the IO is the first Item, then Filters, Features, Segmentation. and if we put '-' in catlog, It will be parsed as a spliter line.</p>
<h2>What can ImagePy do </h2>
<img src="http://idoc.imagepy.org/itk/view.png" alt="view" class="inline"/>
<p><b>ImagePy</b> can wrap any numpy based libraries, can generate table esaily. In the basic version, It contains scikit-image, and I want to build a opencv-plgs and a itk-plgs. then integrate them, <b>It will be powerful than Fiji</b>, and be more esaily to extend.</p>
<p><b>OK! That is a start, I want more developer can join. I think it is significative to let ITK be esaier to approach, Benifit more scientists who does not master programming. But I cannot do it by myself, My English is not so good, and have little spare time, But I will do my best!</b></p>
<h2>Something Imperfect </h2>
<p><b>as simple itk cannot treat numpy array directly, so we must use GetImageFromArray and GetArrayFromImage, Did you have any better method?</b> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
